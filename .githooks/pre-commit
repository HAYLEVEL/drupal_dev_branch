#!/bin/sh

# Get a list of changed files that match the specified extensions
CHANGED_FILES=$(git diff --cached --name-only | grep -E '\.php$|\.install$|\.module$|\.theme$')

# If there are no relevant changed files, skip PHPCS
if [ -z "$CHANGED_FILES" ]; then
  echo "No PHP-related files have changed, skipping PHPCS."
  exit 0
fi

# Run PHPCS on the changed files
vendor/bin/phpcs $CHANGED_FILES --extensions=php,install,module,theme

# Capture the exit code of PHPCS
PHPCS_STATUS=$?

# If PHPCS returns any errors, prevent the commit
if [ $PHPCS_STATUS -ne 0 ]; then
  echo "PHPCS found coding standard violations. Please fix them before committing."
  exit 1
fi

exit 0
